(eval-when (:compile-toplevel :load-toplevel :execute)
  (asdf:oos 'asdf:load-op :cffi))

(defpackage :cffi-user
    (:use :common-lisp :cffi))

(in-package :cffi-user)

(define-foreign-library xingapi
  (t (:default "./xingAPI")))

(use-foreign-library xingapi)

;; BOOL __stdcall ETK_Connect ( 
;; 	HWND 		hWnd, 
;; 	const char*	pszSvr, 
;; 	int		nPort,
;; 	int		nStartMsgID,
;; 	int		nTimeOut,
;; 	int		nSendMaxPacketSize
;; )

(defctype hwnd :unsigned-int)

(defcfun "ETK-Connect" :int
  (hWnd hwnd)
  (pszSvr :string)
  (nPort :int)
  (nStartMsgID :int)
  (nTimeOut :int)
  (nSendMaxPacketSize :int))

(ETK-Connect 0 "hts.etrade.co.kr" 20001 1024 10 -1)
